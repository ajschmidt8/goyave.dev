<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authentication | Goyave</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" type="image/png" sizes="16x16" href="/goyave_16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/goyave_32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/goyave_64.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/goyave_128.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/goyave_256.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/goyave_512.png">
    <meta name="description" content="Goyave is a Golang REST API framework aiming at cleanliness, fast development and power.">
    <meta name="og:title" content="Authentication - Goyave">
    <meta name="twitter:title" content="Authentication - Goyave">
    <meta name="title" content="Authentication - Goyave">
    <meta property="twitter:description" content="Goyave is a Golang REST API framework aiming at cleanliness, fast development and power.">
    <meta property="twitter:image:src" content="https://goyave.dev/goyave_banner.png">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="og:type" content="website">
    <meta property="og:description" content="Goyave is a Golang REST API framework aiming at cleanliness, fast development and power.">
    <meta property="og:image" content="https://goyave.dev/goyave_banner.png">
    <meta property="og:site_name" content="Goyave">
    
    <link rel="preload" href="/assets/css/0.styles.26dd6e4b.css" as="style"><link rel="preload" href="/assets/js/app.6ffc6220.js" as="script"><link rel="preload" href="/assets/js/5.1c93d9fd.js" as="script"><link rel="preload" href="/assets/js/1.f79eb711.js" as="script"><link rel="preload" href="/assets/js/12.b7810994.js" as="script"><link rel="preload" href="/assets/js/6.a7e8bb94.js" as="script"><link rel="prefetch" href="/assets/js/10.37f2133a.js"><link rel="prefetch" href="/assets/js/11.4ebe3b0e.js"><link rel="prefetch" href="/assets/js/13.e2bf4254.js"><link rel="prefetch" href="/assets/js/14.5d3ccbdb.js"><link rel="prefetch" href="/assets/js/15.a6526a57.js"><link rel="prefetch" href="/assets/js/16.5a37ced7.js"><link rel="prefetch" href="/assets/js/17.e7b6af0e.js"><link rel="prefetch" href="/assets/js/18.2b65ab11.js"><link rel="prefetch" href="/assets/js/19.387d3088.js"><link rel="prefetch" href="/assets/js/20.41cad5cf.js"><link rel="prefetch" href="/assets/js/21.c81594c8.js"><link rel="prefetch" href="/assets/js/22.45251716.js"><link rel="prefetch" href="/assets/js/23.c07afcba.js"><link rel="prefetch" href="/assets/js/24.62fcae00.js"><link rel="prefetch" href="/assets/js/25.6cceeeb3.js"><link rel="prefetch" href="/assets/js/26.95f226e8.js"><link rel="prefetch" href="/assets/js/27.22739ec1.js"><link rel="prefetch" href="/assets/js/28.fdeac3b0.js"><link rel="prefetch" href="/assets/js/29.9eb65d6d.js"><link rel="prefetch" href="/assets/js/30.cccb87a9.js"><link rel="prefetch" href="/assets/js/31.a2a242a7.js"><link rel="prefetch" href="/assets/js/32.e211a80c.js"><link rel="prefetch" href="/assets/js/33.ccebd016.js"><link rel="prefetch" href="/assets/js/34.fcb0ba15.js"><link rel="prefetch" href="/assets/js/35.42c42f3c.js"><link rel="prefetch" href="/assets/js/36.2ef6b321.js"><link rel="prefetch" href="/assets/js/37.07610d51.js"><link rel="prefetch" href="/assets/js/38.115fd1cc.js"><link rel="prefetch" href="/assets/js/39.11c8fbda.js"><link rel="prefetch" href="/assets/js/4.e0abb74f.js"><link rel="prefetch" href="/assets/js/40.a1be762e.js"><link rel="prefetch" href="/assets/js/41.b73e4345.js"><link rel="prefetch" href="/assets/js/42.82d183c9.js"><link rel="prefetch" href="/assets/js/43.af2ed02a.js"><link rel="prefetch" href="/assets/js/44.06899574.js"><link rel="prefetch" href="/assets/js/45.c63bf94c.js"><link rel="prefetch" href="/assets/js/46.277fc903.js"><link rel="prefetch" href="/assets/js/47.117a430d.js"><link rel="prefetch" href="/assets/js/48.33f3affc.js"><link rel="prefetch" href="/assets/js/49.b9251756.js"><link rel="prefetch" href="/assets/js/50.a1711a53.js"><link rel="prefetch" href="/assets/js/51.9bd1e763.js"><link rel="prefetch" href="/assets/js/52.d36faf2a.js"><link rel="prefetch" href="/assets/js/53.1da7fe88.js"><link rel="prefetch" href="/assets/js/54.e06eaa9f.js"><link rel="prefetch" href="/assets/js/55.2ca44bcc.js"><link rel="prefetch" href="/assets/js/56.9c2d768a.js"><link rel="prefetch" href="/assets/js/57.e1510a48.js"><link rel="prefetch" href="/assets/js/58.9125b2d0.js"><link rel="prefetch" href="/assets/js/59.19823e8a.js"><link rel="prefetch" href="/assets/js/60.c8bb5961.js"><link rel="prefetch" href="/assets/js/61.456be12d.js"><link rel="prefetch" href="/assets/js/62.9660de18.js"><link rel="prefetch" href="/assets/js/7.ae4e33f4.js"><link rel="prefetch" href="/assets/js/8.b5561a44.js"><link rel="prefetch" href="/assets/js/9.53821f89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f357826b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.26dd6e4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-3fedb5af><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/goyave_64.png" alt="Goyave" class="logo"> <span class="site-name can-hide">Goyave</span></a> <div class="links"><div class="user-settings"><a title="Dark theme" href="#" class="settings-button"><svg aria-hidden="true" data-prefix="fas" data-icon="cog" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="svg-inline--fa fa-cog fa-w-16 settings-icon"><path fill="currentColor" d="M8 0c-4.4 0-8 3.6-8 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zM8 15c-3.9 0-7-3.1-7-7 0-2.4 1.2-4.6 3.2-5.9-0.1 0.6-0.2 1.3-0.2 1.9 0 4.9 4 8.9 8.9 9-1.3 1.3-3 2-4.9 2z"></path></svg></a></div> <form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide Menu" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide Menu" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link router-link-active">
  v4
</a></li><li class="dropdown-item"><!----> <a href="/v3/guide/" class="nav-link">
  v3
</a></li></ul></div></div><div class="nav-item"><a href="https://pkg.go.dev/goyave.dev/goyave/v4" target="_blank" rel="noopener noreferrer" class="nav-link external">
  pkg.go.dev
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/go-goyave/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide Menu" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide Menu" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link router-link-active">
  v4
</a></li><li class="dropdown-item"><!----> <a href="/v3/guide/" class="nav-link">
  v3
</a></li></ul></div></div><div class="nav-item"><a href="https://pkg.go.dev/goyave.dev/goyave/v4" target="_blank" rel="noopener noreferrer" class="nav-link external">
  pkg.go.dev
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/go-goyave/goyave" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="sponsors" data-v-094edf48><!----> <a href="https://github.com/sponsors/System-Glitch/" rel="nofollow" target="_blank" class="become-backer" data-v-094edf48>
    Become a Sponsor
  </a></div> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Basics</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Advanced</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/advanced/utilities.html" class="sidebar-link">Utilities</a></li><li><a href="/guide/advanced/authentication.html" aria-current="page" class="active sidebar-link">Authentication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/advanced/authentication.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/guide/advanced/authentication.html#authenticators" class="sidebar-link">Authenticators</a></li><li class="sidebar-sub-header"><a href="/guide/advanced/authentication.html#permissions" class="sidebar-link">Permissions</a></li></ul></li><li><a href="/guide/advanced/localization.html" class="sidebar-link">Localization</a></li><li><a href="/guide/advanced/testing.html" class="sidebar-link">Testing</a></li><li><a href="/guide/advanced/multi-services.html" class="sidebar-link">Multi-services</a></li><li><a href="/guide/advanced/cors.html" class="sidebar-link">CORS</a></li><li><a href="/guide/advanced/status-handlers.html" class="sidebar-link">Status Handlers</a></li><li><a href="/guide/advanced/logging.html" class="sidebar-link">Logging</a></li><li><a href="/guide/advanced/rate-limiting.html" class="sidebar-link">Rate Limiting</a></li><li><a href="/guide/advanced/websocket.html" class="sidebar-link">Websocket</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Libraries</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h1> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>Since v2.5.0</span> <p></p><div class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#authenticators">Authenticators</a><ul><li><a href="#basic-auth">Basic Auth</a></li><li><a href="#json-web-token-jwt">JSON Web Token (JWT)</a></li><li><a href="#writing-custom-authenticator">Writing custom Authenticator</a></li></ul></li><li><a href="#permissions">Permissions</a></li></ul></div><p></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Goyave provides a convenient and expandable way of handling authentication in your application. Authentication can be enabled when registering your routes:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;goyave.dev/goyave/v4/auth&quot;</span>

<span class="token comment">//...</span>

authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>BasicAuthenticator<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><p>Authentication is handled by a simple middleware calling an <strong>Authenticator</strong>. This middleware also needs a model, which will be used to fetch user information on a successful login.</p> <h4 id="auth-middleware"><a href="#auth-middleware" class="header-anchor">#</a> auth.Middleware</h4> <p>Middleware create a new authenticator middleware to authenticate the given model using the given authenticator.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>model interface{}</code></td> <td><code>goyave.Middleware</code></td></tr> <tr><td><code>authenticator Authenticator</code></td> <td></td></tr></tbody></table> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>BasicAuthenticator<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><h2 id="authenticators"><a href="#authenticators" class="header-anchor">#</a> Authenticators</h2> <p>This section will go into more details about Authenticators and explain the built-in ones. You will also learn how to implement an authenticator yourself.</p> <p><strong><code>Authenticator</code></strong> is a functional interface with a single method accepting a request and a model pointer as parameters.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token function">Authenticate</span><span class="token punctuation">(</span>request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> user <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
</code></pre></div><p>The goal of this function is to check user credentials, most of the time from the request's <strong>headers</strong>. If they are correct and the user can be authenticated, the <code>user</code> parameter is updated with the user's information. User information is most of the time fetched from the database.</p> <p>On the other hand, if the user cannot be authenticated, the <code>Authenticate</code> method must return an <code>error</code> containing a localized message. For example, the error could be that the token lifetime is expired, thus &quot;Your authentication token is expired.&quot; will be returned.</p> <p>Authenticators use their model's struct fields tags to know which field to use for username and password. To make your model compatible with authentication, you must add the <code>auth:&quot;username&quot;</code> and <code>auth:&quot;password&quot;</code> tags:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Email    <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:char(100);uniqueIndex&quot; auth:&quot;username&quot;`</span>
	Name     <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:char(100)&quot;`</span>
	Password <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:char(60)&quot; auth:&quot;password&quot;`</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li>The username should be <strong>unique</strong>.</li> <li>Passwords should be <strong>hashed</strong> before being stored in the database.</li></ul> <p>Built-in Goyave Authenticators use <a href="https://pkg.go.dev/golang.org/x/crypto/bcrypt" target="_blank" rel="noopener noreferrer"><code>bcrypt</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to check if a password matches the user request.</p></div> <p>When a user is successfully authenticated on a protected route, its information is available in the controller handler, through the request <code>User</code> field.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span>response <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	user <span class="token operator">:=</span> request<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>model<span class="token punctuation">.</span>User<span class="token punctuation">)</span>
	response<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Remember that Goyave is primarily focused on APIs. It doesn't use session nor cookies in its core features, making requests <strong>stateless</strong>.</p> <p>If you want to implement cookie or session-based authentication, be sure to protect your application from <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank" rel="noopener noreferrer">CSRF attacks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h3 id="basic-auth"><a href="#basic-auth" class="header-anchor">#</a> Basic Auth</h3> <p><a href="https://en.wikipedia.org/wiki/Basic_access_authentication" target="_blank" rel="noopener noreferrer">Basic authentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is an authentication method using the <code>Authorization</code> header and a simple username and password combination with the following format: <code>username:password</code>, encoded in base64. There are two built-in Authenticators for Basic auth.</p> <h4 id="database-provider"><a href="#database-provider" class="header-anchor">#</a> Database provider</h4> <p>This Authenticator fetches the user information from the database, using the field tags explained earlier.</p> <p>To apply this protection to your routes, add the following middleware:</p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>BasicAuthenticator<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><p>You can then try requesting a protected route:</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -u username:password http://localhost:8080/hello
Hello Jérémy
</code></pre></div><p>This provider supports the <code>Optional</code> flag, which defines if the authenticator allows requests that don't provide credentials. Handlers should therefore check if <code>request.User</code> is not <code>nil</code> before accessing it.</p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>BasicAuthenticator<span class="token punctuation">{</span>Optional<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><h4 id="config-provider"><a href="#config-provider" class="header-anchor">#</a> Config provider</h4> <p>This Authenticator fetches the user information from the config. This method is good for quick proof-of-concepts, as it requires minimum setup, but shouldn't be used in real-world applications.</p> <ul><li>The <code>auth.basic.username</code> config entry defines the username that must be matched.</li> <li>The <code>auth.basic.password</code> config entry defines the password that must be matched.</li></ul> <p>To apply this protection to your routes, start by adding the <code>auth</code> category at the root of your configuration, and the <code>auth.basic</code> sub-category:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;basic&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, add the following middleware:</p> <div class="language-go extra-class"><pre class="language-go"><code>router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">ConfigBasicAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>The model used for this Authenticator is <code>auth.BasicUser</code>:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> BasicUser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can then try requesting a protected route:</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -u username:password http://localhost:8080/hello
</code></pre></div><h4 id="auth-configbasicauth"><a href="#auth-configbasicauth" class="header-anchor">#</a> auth.ConfigBasicAuth</h4> <p>Create a new authenticator middleware for config-based Basic authentication. On auth success, the request user is set to a <code>auth.BasicUser</code>.
The user is authenticated if the <code>auth.basic.username</code> and <code>auth.basic.password</code> config entries match the request's Authorization header.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td></td> <td><code>goyave.Middleware</code></td></tr></tbody></table> <h3 id="json-web-token-jwt"><a href="#json-web-token-jwt" class="header-anchor">#</a> JSON Web Token (JWT)</h3> <p>JWT, or <a href="https://en.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="noopener noreferrer">JSON Web Token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, is an open standard of authentication that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public/private key pair using RSA or ECDSA. Goyave supports HMAC, RSA (with or without password) and ECDSA. RSA and ECDSA require <strong>PEM-encoded</strong> keys. Goyave uses the <a href="https://github.com/golang-jwt/jwt" target="_blank" rel="noopener noreferrer">golang-jwt/jwt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library in the background.</p> <p>JWT Authentication comes with the <code>auth.jwt.expiry</code> configuration entry, which defines the number of seconds a token is valid for and defaults to <code>300</code> (5 minutes).</p> <h4 id="basic-usage"><a href="#basic-usage" class="header-anchor">#</a> Basic usage</h4> <p>By default, Goyave's built-in JWT components will use HMAC-SHA256 to sign generated tokens and will expect this method for signature verification. In this basic usage example, this is what we are going to use. Check the next sections for details on how to use RSA or ECDSA.</p> <p>To apply JWT authentication to your routes, start by adding the <code>auth</code> category at the root of your configuration, and the <code>auth.jwt</code> sub-category:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;jwt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
      <span class="token property">&quot;secret&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jwt-secret&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Make sure your HMAC secret is securely generated and is long enough:</p> <ul><li>HMAC-SHA256: the secret must be 256+ bits long</li> <li>HMAC-SHA384: the secret must be 384+ bits long</li> <li>HMAC-SHA512: the secret must be 512+ bits long</li></ul></div> <p>Then, add the following middleware:</p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>JWTAuthenticator<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><p>To request a protected route, you will need to add the following header:</p> <div class="language- extra-class"><pre class="language-text"><code>Authorization: Bearer &lt;YOUR_TOKEN&gt;
</code></pre></div><h5 id="optional-authentication"><a href="#optional-authentication" class="header-anchor">#</a> Optional authentication</h5> <p>This provider supports the <code>Optional</code> flag, which defines if the authenticator allows requests that don't provide credentials. Handlers should therefore check if <code>request.User</code> is not <code>nil</code> before accessing it.</p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>JWTAuthenticator<span class="token punctuation">{</span>Optional<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><h5 id="custom-id-claim-name"><a href="#custom-id-claim-name" class="header-anchor">#</a> Custom ID claim name</h5> <p>By default, <code>auth.JWTAuthenticator</code> looks for the claim named <code>sub</code> in the given token. You can customize the name of the token using the <code>ClaimName</code> field:</p> <div class="language-go extra-class"><pre class="language-go"><code>authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>JWTAuthenticator<span class="token punctuation">{</span>ClaimName<span class="token punctuation">:</span> <span class="token string">&quot;userid&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><h5 id="claims-in-request-extra"><a href="#claims-in-request-extra" class="header-anchor">#</a> Claims in request.Extra</h5> <p>If a token is valid (even if authentication fails), its claims are put into <code>request.Extra</code> with the <code>jwt_claims</code> key, so you can access them in any subsequent handler:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/golang-jwt/jwt&quot;</span>

<span class="token comment">//...</span>

<span class="token keyword">func</span> <span class="token function">myHandler</span><span class="token punctuation">(</span>resp <span class="token operator">*</span>Response<span class="token punctuation">,</span> r <span class="token operator">*</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	claims <span class="token operator">:=</span> request<span class="token punctuation">.</span>Extra<span class="token punctuation">[</span><span class="token string">&quot;jwt_claims&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">)</span>
	<span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="rsa"><a href="#rsa" class="header-anchor">#</a> RSA</h4> <p>If you expect tokens to be signed with RSA, you will need to add the <code>auth.jwt.rsa.public</code> configuration entry. This entry defines the path to the <strong>PEM-encoded</strong> RSA public key file. Make sure the system user running your application has read access. Both absolute and relative paths are supported.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;jwt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
      <span class="token property">&quot;rsa&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		  <span class="token property">&quot;public&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/rsa-key.pem&quot;</span>
	  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, specify the expected signature method in the <code>SignatureMethod</code> field of <code>auth.JWTAuthenticator</code>:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/golang-jwt/jwt&quot;</span>

<span class="token comment">//...</span>

authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>JWTAuthenticator<span class="token punctuation">{</span>SigningMethod<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>SigningMethodRS256<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can find the list of available methods in the <a href="https://pkg.go.dev/github.com/golang-jwt/jwt#SigningMethodRSA" target="_blank" rel="noopener noreferrer">jwt-go documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <ul><li>For testing purposes, you can generate an RSA key-pair using OpenSSL:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>openssl genrsa -out rsa-private.pem 2048
openssl rsa -in rsa-private.pem -outform PEM -pubout -out rsa-public.pem
</code></pre></div></div> <h4 id="ecdsa"><a href="#ecdsa" class="header-anchor">#</a> ECDSA</h4> <p>If you expect tokens to be signed with ECDSA, you will need to add the <code>auth.jwt.ecdsa.public</code> configuration entry. This entry defines the path to the <strong>PEM-encoded</strong> ECDSA public key file. Make sure the system user running your application has read access. Both absolute and relative paths are supported.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;auth&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;jwt&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
      <span class="token property">&quot;rsa&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		  <span class="token property">&quot;public&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/path/to/ecdsa-key.pem&quot;</span>
	  <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then, specify the expected signature method in the <code>SignatureMethod</code> field of <code>auth.JWTAuthenticator</code>:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/golang-jwt/jwt&quot;</span>

<span class="token comment">//...</span>

authenticator <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>auth<span class="token punctuation">.</span>JWTAuthenticator<span class="token punctuation">{</span>SigningMethod<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>SigningMethodES256<span class="token punctuation">}</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">Middleware</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>You can find the list of available methods in the <a href="https://pkg.go.dev/github.com/golang-jwt/jwt#SigningMethodECDSA" target="_blank" rel="noopener noreferrer">jwt-go documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>For testing purposes, you can generate an ECDSA key-pair using OpenSSL:</li></ul> <div class="language- extra-class"><pre class="language-text"><code>openssl ecparam -name prime256v1 -genkey -noout -out ecdsa-private.key
openssl pkcs8 -topk8 -in ecdsa-private.key -out ecdsa-private.pem
openssl ec -in ecdsa-private.pem -pubout -out ecdsa-public.pem
</code></pre></div></div> <h4 id="generating-tokens"><a href="#generating-tokens" class="header-anchor">#</a> Generating tokens</h4> <h4 id="auth-generatetokenwithclaims"><a href="#auth-generatetokenwithclaims" class="header-anchor">#</a> auth.GenerateTokenWithClaims</h4> <p>Generate a new JWT with custom claims and signed using the given signing method.</p> <p>The token is set to expire in the amount of seconds defined by the <code>auth.jwt.expiry</code> config entry.</p> <p>Depending on the given signing method, the following configuration entries will be used:</p> <ul><li>RSA:
<ul><li><code>auth.jwt.rsa.private</code>: path to the private PEM-encoded RSA key.</li> <li><code>auth.jwt.rsa.password</code>: optional password for the private RSA key.</li></ul></li> <li>ECDSA: <code>auth.jwt.ecdsa.private</code>: path to the private PEM-encoded ECDSA key.</li> <li>HMAC: <code>auth.jwt.secret</code>: HMAC secret</li></ul> <p>The generated token will also contain the following claims:</p> <ul><li><code>nbf</code>: &quot;Not before&quot;, the current timestamp is used</li> <li><code>exp</code>: &quot;Expiry&quot;, the current timestamp plus the <code>auth.jwt.expiry</code> config entry.</li></ul> <p><code>nbf</code> and <code>exp</code> can be overridden if they are set in the <code>claims</code> parameter.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>claims jwt.MapClaims</code></td> <td><code>string</code></td></tr> <tr><td><code>signingMethod jwt.SigningMethod</code></td> <td><code>error</code></td></tr></tbody></table> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/golang-jwt/jwt&quot;</span>

<span class="token comment">//...</span>

token<span class="token punctuation">,</span> err <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">GenerateTokenWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">{</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">}</span><span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>SigningMethodES256<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
</code></pre></div><h4 id="auth-generatetoken"><a href="#auth-generatetoken" class="header-anchor">#</a> auth.GenerateToken</h4> <p>Generate a new JWT. This function is a shortcut to <code>auth.GenerateTokenWithClaims()</code>.</p> <p>The token is created using the HMAC SHA256 method and signed using the <code>auth.jwt.secret</code> config entry.<br>
The token is set to expire in the amount of seconds defined by the <code>auth.jwt.expiry</code> config entry.</p> <p>The generated token will contain the following claims:</p> <ul><li><code>userid</code>: has the value of the <code>id</code> parameter</li> <li><code>nbf</code>: &quot;Not before&quot;, the current timestamp is used</li> <li><code>exp</code>: &quot;Expiry&quot;, the current timestamp plus the <code>auth.jwt.expiry</code> config entry.</li></ul> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>id interface{}</code></td> <td><code>string</code></td></tr> <tr><td></td> <td><code>error</code></td></tr></tbody></table> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code>token<span class="token punctuation">,</span> err <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">GenerateToken</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="jwtcontroller"><a href="#jwtcontroller" class="header-anchor">#</a> JWTController</h4> <p>JWTAuthenticator comes with a built-in login controller for password grant, using the field tags explained earlier. You can register the <code>/auth/login</code> route using the helper function <code>auth.JWTRoutes(router)</code>.</p> <h4 id="auth-jwtroutes"><a href="#auth-jwtroutes" class="header-anchor">#</a> auth.JWTRoutes</h4> <p>Create a <code>/auth</code> route group and registers the <code>POST /auth/login</code> validated route. Returns the new route group.</p> <p>Validation rules are as follows:</p> <ul><li><code>username</code>: required string</li> <li><code>password</code>: required string</li></ul> <p>The given model is used for username and password retrieval and for instantiating an authenticated request's user.</p> <p>Ensure that the given router <strong>is not</strong> protected by JWT authentication, otherwise your users wouldn't be able to log in.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>router *goyave.Router</code></td> <td><code>*goyave.Router</code></td></tr> <tr><td><code>model interface{}</code></td> <td></td></tr></tbody></table> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Register</span><span class="token punctuation">(</span>router <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Router<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	auth<span class="token punctuation">.</span><span class="token function">JWTRoutes</span><span class="token punctuation">(</span>router<span class="token punctuation">,</span> <span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="auth-newjwtcontroller"><a href="#auth-newjwtcontroller" class="header-anchor">#</a> auth.NewJWTController</h4> <p>If you want or need to register the routes yourself, you can instantiate a new <code>JWTController</code> using <code>auth.NewJWTController()</code>.</p> <p>This function creates a new <code>JWTController</code> that will be using the given model for login and token generation.</p> <p>A <code>JWTController</code> contains one handler called <code>Login</code>.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>model interface{}</code></td> <td><code>*auth.JWTController</code></td></tr></tbody></table> <p><strong>Example:</strong></p> <div class="language-go extra-class"><pre class="language-go"><code>jwtRouter <span class="token operator">:=</span> router<span class="token punctuation">.</span><span class="token function">Subrouter</span><span class="token punctuation">(</span><span class="token string">&quot;/auth&quot;</span><span class="token punctuation">)</span>
jwtRouter<span class="token punctuation">.</span><span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> auth<span class="token punctuation">.</span><span class="token function">NewJWTController</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Login<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span>validation<span class="token punctuation">.</span>RuleSet<span class="token punctuation">{</span>
	<span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> validation<span class="token punctuation">.</span>List<span class="token punctuation">{</span><span class="token string">&quot;required&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> validation<span class="token punctuation">.</span>List<span class="token punctuation">{</span><span class="token string">&quot;required&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default, the controller will use the &quot;username&quot; and &quot;password&quot; fields from incoming requests for the authentication process. This can be changed by modifying the controller's  <code>UsernameField</code> and <code>PasswordField</code> structure fields:</p> <div class="language-go extra-class"><pre class="language-go"><code>jwtController <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">NewJWTController</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
jwtController<span class="token punctuation">.</span>UsernameField <span class="token operator">=</span> <span class="token string">&quot;email&quot;</span>
jwtController<span class="token punctuation">.</span>PasswordField <span class="token operator">=</span> <span class="token string">&quot;pwd&quot;</span>
</code></pre></div></div> <h5 id="signing-method"><a href="#signing-method" class="header-anchor">#</a> Signing method</h5> <p>As <code>JWTController</code> generates token for you, you can also customize the signing method it uses. By default, HMAC-SHA256 is used. You can override this by changing the <code>SigningMethod</code> field:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/golang-jwt/jwt&quot;</span>

<span class="token comment">//...</span>

jwtController <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">NewJWTController</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
jwtController<span class="token punctuation">.</span>SigningMethod <span class="token operator">=</span> jwt<span class="token punctuation">.</span>SigningMethodES256
</code></pre></div><h5 id="custom-token-generation"><a href="#custom-token-generation" class="header-anchor">#</a> Custom token generation</h5> <p>You can also override the token generation logic executed by the controller on successful authentication by setting the <code>TokenFunc</code> field:</p> <div class="language-go extra-class"><pre class="language-go"><code>jwtController <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">NewJWTController</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
jwtController<span class="token punctuation">.</span>TokenFunc <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> user <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">GenerateTokenWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">{</span>
		<span class="token string">&quot;sub&quot;</span><span class="token punctuation">:</span>  user<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>model<span class="token punctuation">.</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>ID<span class="token punctuation">,</span>
		<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>model<span class="token punctuation">.</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>auth.TokenFunc</code> is an alias for <code>func(request *goyave.Request, user interface{}) (string, error)</code></p></div> <h3 id="writing-custom-authenticator"><a href="#writing-custom-authenticator" class="header-anchor">#</a> Writing custom Authenticator</h3> <p>The Goyave authentication system is expandable, meaning that you can implement more authentication methods by creating a new <code>Authenticator</code>.</p> <p>The typical <code>Authenticator</code> is an empty struct implementing the <code>Authenticator</code> interface:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> MyAuthenticator <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Ensure you're correctly implementing Authenticator.</span>
<span class="token keyword">var</span> <span class="token boolean">_</span> auth<span class="token punctuation">.</span>Authenticator <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>MyAuthenticator<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// implements Authenticator</span>
</code></pre></div><p>The next step is to implement the <code>Authenticate</code> method. Its purpose is explained at the start of this guide.</p> <p>In this example, we are going to authenticate the user using a simple token stored in the database.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>MyAuthenticator<span class="token punctuation">)</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span>request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> user <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	token<span class="token punctuation">,</span> ok <span class="token operator">:=</span> request<span class="token punctuation">.</span><span class="token function">BearerToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>lang<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Lang<span class="token punctuation">,</span> <span class="token string">&quot;auth.no-credentials-provided&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Find the struct field tagged with `auth:&quot;token&quot;`</span>
	columns <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">FindColumns</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">// Find the user in the database using its token</span>
	result <span class="token operator">:=</span> database<span class="token punctuation">.</span><span class="token function">Conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>columns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Name<span class="token operator">+</span><span class="token string">&quot; = ?&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>

	<span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Error<span class="token punctuation">,</span> gorm<span class="token punctuation">.</span>ErrRecordNotFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// User not found, return &quot;Invalid credentials.&quot;</span>
			<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>lang<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Lang<span class="token punctuation">,</span> <span class="token string">&quot;auth.invalid-credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// Database error</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Authentication successful</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="auth-unauthorizer"><a href="#auth-unauthorizer" class="header-anchor">#</a> auth.Unauthorizer</h4> <p>If you need to override the default behavior when the authentication fails, you can implement the <code>auth.Unauthorizer</code> interface on your <code>Authenticator</code>.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>MyAuthenticator<span class="token punctuation">)</span> <span class="token function">OnUnauthorized</span><span class="token punctuation">(</span>response <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> request <span class="token operator">*</span>goyave<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	response<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusUnauthorized<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;authError&quot;</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="auth-findcolumns"><a href="#auth-findcolumns" class="header-anchor">#</a> auth.FindColumns</h4> <p>Find columns in the given struct. A field matches if it has a &quot;auth&quot; tag with the given value.
Returns a slice of found fields, ordered as the input <code>fields</code> slice.</p> <p>Promoted fields are matched as well.</p> <p>If the nth field is not found, the nth value of the returned slice will be <code>nil</code>.</p> <table><thead><tr><th>Parameters</th> <th>Return</th></tr></thead> <tbody><tr><td><code>struct interface{}</code></td> <td><code>[]*auth.Column</code></td></tr> <tr><td><code>fields ...string</code></td> <td></td></tr></tbody></table> <p><strong>Example</strong>:</p> <p>Given the following struct and <code>username</code>, <code>notatag</code>, <code>password</code>:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> TestUser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name     <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:varchar(100)&quot;`</span>
	Password <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:varchar(100)&quot; auth:&quot;password&quot;`</span>
	Email    <span class="token builtin">string</span> <span class="token string">`gorm:&quot;type:varchar(100);uniqueIndex&quot; auth:&quot;username&quot;`</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>fields <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">FindColumns</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;notatag&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>The result will be the <code>Email</code> field, <code>nil</code> and the <code>Password</code> field.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The <code>Column</code> struct is defined as follows:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Column <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Name  <span class="token builtin">string</span>
	Field <span class="token operator">*</span>reflect<span class="token punctuation">.</span>StructField
<span class="token punctuation">}</span>
</code></pre></div></div> <h2 id="permissions"><a href="#permissions" class="header-anchor">#</a> Permissions</h2> <p style="text-align:center;"><img src="/undraw_in_progress_ql66.svg" height="150" alt="In progress"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This feature is not implemented yet and is coming in a future release.</p> <p><a href="https://github.com/go-goyave/goyave" target="_blank" rel="noopener noreferrer">Watch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> the github repository to stay updated.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/go-goyave/goyave.dev/edit/master/src/guide/advanced/authentication.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/advanced/utilities.html" class="prev">
        Utilities
      </a></span> <span class="next"><a href="/guide/advanced/localization.html">
        Localization
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6ffc6220.js" defer></script><script src="/assets/js/5.1c93d9fd.js" defer></script><script src="/assets/js/1.f79eb711.js" defer></script><script src="/assets/js/12.b7810994.js" defer></script><script src="/assets/js/6.a7e8bb94.js" defer></script>
  </body>
</html>
